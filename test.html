<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CodeHub - 웹 개발 플레이그라운드</title>
<style>
/* ----------------- 기본 레이아웃 ----------------- */
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#0d1117;--panel:#161b22;--muted:#8b949e;--accent:#1f6feb;--card:#0b1220;--text:#e6edf3
}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Inter,system-ui,Arial;background:var(--bg);color:var(--text);height:100vh;overflow:hidden}

/* header */
.header{background:var(--panel);border-bottom:1px solid #30363d;padding:12px 20px;display:flex;align-items:center;justify-content:space-between;box-shadow:0 1px 3px rgba(0,0,0,0.12)}
.logo{display:flex;align-items:center;gap:12px;font-size:1.2rem;font-weight:600;color:#f0f6fc}
.logo-icon{width:32px;height:32px;background:linear-gradient(135deg,#7c3aed,#3b82f6);border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:1.2rem}

/* header actions */
.header-actions{display:flex;gap:12px;align-items:center}
.btn{background:#21262d;border:1px solid #30363d;color:var(--text);padding:6px 16px;border-radius:6px;font-size:14px;font-weight:500;cursor:pointer;display:flex;align-items:center;gap:6px}
.btn:hover{background:#30363d;border-color:#8b949e}
.btn-primary{background:#238636;border-color:#238636}
.btn-primary:hover{background:#2ea043;border-color:#2ea043}

/* main layout */
.main-container{display:flex;height:calc(100vh - 60px)}
.sidebar{width:280px;background:var(--bg);border-right:1px solid #30363d;display:flex;flex-direction:column}
.file-explorer{padding:16px;border-bottom:1px solid #30363d}
.explorer-title{font-size:14px;font-weight:600;color:#f0f6fc;margin-bottom:12px;display:flex;align-items:center;justify-content:space-between}
.file-list{list-style:none;max-height:220px;overflow:auto}
.file-item{padding:6px 8px;border-radius:4px;cursor:pointer;font-size:14px;display:flex;align-items:center;gap:8px;transition:background .15s}
.file-item:hover{background:#21262d}
.file-item.active{background:var(--accent);color:#fff}
.file-icon{width:16px;height:16px;display:flex;align-items:center;justify-content:center}

/* templates */
.templates{padding:16px;flex:1}
.templates-title{font-size:14px;font-weight:600;color:#f0f6fc;margin-bottom:12px}
.template-item{padding:12px;background:var(--panel);border:1px solid #30363d;border-radius:6px;margin-bottom:8px;cursor:pointer;transition:all .12s}
.template-item:hover{border-color:#8b949e;background:#21262d}
.template-name{font-weight:500;font-size:14px;margin-bottom:4px}
.template-desc{font-size:12px;color:var(--muted)}

/* editor area */
.editor-container{flex:1;display:flex;flex-direction:column}
.tabs{background:var(--panel);border-bottom:1px solid #30363d;display:flex;align-items:center;padding:0 16px;min-height:48px}
.tab{padding:8px 16px;background:transparent;border:none;color:var(--muted);font-size:14px;cursor:pointer;border-radius:6px 6px 0 0;display:flex;align-items:center;gap:8px}
.tab.active{background:var(--bg);color:var(--text);border-bottom:2px solid var(--accent)}
.tab:hover:not(.active){background:#21262d;color:var(--text)}

.editor-panes{flex:1;display:flex}
.editor-pane{flex:1;display:none;flex-direction:column}
.editor-pane.active{display:flex}
.editor-with-numbers{display:flex;flex:1;min-height:0}
.line-numbers{background:var(--bg);color:#6e7681;padding:20px 8px;font-family:'JetBrains Mono',monospace;font-size:14px;line-height:1.5;text-align:right;border-right:1px solid #21262d;user-select:none;min-width:50px;overflow:auto}
.code-editor{flex:1;background:var(--bg);font-family:'JetBrains Mono',monospace;font-size:14px;line-height:1.5;border:none;outline:none;resize:none;padding:20px;color:var(--text);tab-size:2;min-height:0}
.code-editor::placeholder{color:#6e7681}

/* preview */
.preview-container{width:50%;background:#ffffff;border-left:1px solid #30363d;display:flex;flex-direction:column}
.preview-header{background:#f6f8fa;border-bottom:1px solid #d0d7de;padding:12px 16px;display:flex;align-items:center;justify-content:space-between}
.preview-title{font-size:14px;font-weight:600;color:#24292f}
.preview-actions{display:flex;gap:8px}
.preview-btn{background:#ffffff;border:1px solid #d0d7de;color:#24292f;padding:4px 8px;border-radius:4px;font-size:12px;cursor:pointer}
.preview-btn:hover{background:#f3f4f6}
.preview-frame{flex:1;border:none;background:#fff}

/* status bar */
.status-bar{background:var(--panel);border-top:1px solid #30363d;padding:6px 16px;font-size:12px;color:var(--muted);display:flex;justify-content:space-between;align-items:center}

/* responsive */
@media (max-width:960px){
  .preview-container{display:none}
  .sidebar{width:240px}
  .main-container{flex-direction:column}
}
</style>
</head>
<body>
  <div class="header">
    <div class="logo"><div class="logo-icon">⚡</div>CodeHub</div>
    <div class="header-actions">
      <button class="btn" onclick="saveProject()">💾 저장</button>
      <button class="btn" onclick="shareProject()">🔗 공유</button>
      <button class="btn btn-primary" onclick="runCode()">▶️ 실행</button>
    </div>
  </div>

  <div class="main-container">
    <div class="sidebar">
      <div class="file-explorer">
        <div class="explorer-title">
          파일 탐색기
          <button class="btn" style="padding:2px 6px;font-size:12px" onclick="addNewFile()">+</button>
        </div>
        <ul class="file-list" id="fileList">
          <li class="file-item active" data-file="html"><span class="file-icon">🌐</span>index.html</li>
          <li class="file-item" data-file="css"><span class="file-icon">🎨</span>style.css</li>
          <li class="file-item" data-file="js"><span class="file-icon">⚡</span>script.js</li>
        </ul>
      </div>

      <div class="templates">
        <div class="templates-title">템플릿</div>

        <div class="template-item" onclick="loadTemplate('basic')">
          <div class="template-name">기본 웹페이지</div>
          <div class="template-desc">HTML, CSS, JS 기본 구조</div>
        </div>

        <div class="template-item" onclick="loadTemplate('portfolio')">
          <div class="template-name">포트폴리오</div>
          <div class="template-desc">개인 포트폴리오 사이트</div>
        </div>

        <div class="template-item" onclick="loadTemplate('dashboard')">
          <div class="template-name">대시보드</div>
          <div class="template-desc">관리자 대시보드 UI</div>
        </div>

        <div class="template-item" onclick="loadTemplate('game')">
          <div class="template-name">간단한 게임</div>
          <div class="template-desc">JavaScript 미니게임</div>
        </div>
      </div>
    </div>

    <div class="editor-container">
      <div class="tabs">
        <button class="tab active" data-tab="html">🌐 HTML</button>
        <button class="tab" data-tab="css">🎨 CSS</button>
        <button class="tab" data-tab="js">⚡ JavaScript</button>
      </div>

      <div class="editor-panes">
        <div class="editor-pane active" id="htmlPane">
          <div class="editor-with-numbers">
            <div class="line-numbers" id="htmlLineNumbers">1</div>
            <textarea class="code-editor" id="htmlEditor" placeholder="HTML 코드를 입력하세요..."><!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>내 웹사이트</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>안녕하세요! 👋</h1>
    <p>여기서 멋진 웹사이트를 만들어보세요!</p>
    <button onclick="sayHello()">클릭해보세요</button>
  </div>
  <script src="script.js"></script>
</body>
</html></textarea>
          </div>
        </div>

        <div class="editor-pane" id="cssPane">
          <div class="editor-with-numbers">
            <div class="line-numbers" id="cssLineNumbers">1</div>
            <textarea class="code-editor" id="cssEditor" placeholder="CSS 코드를 입력하세요...">body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
  background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}
.container {
  background:white;padding:40px;border-radius:20px;box-shadow:0 20px 40px rgba(0,0,0,0.1);text-align:center;max-width:500px;
}
h1{color:#333;margin-bottom:20px;font-size:2.5rem}
p{color:#666;font-size:1.2rem;margin-bottom:30px}
button{background:#667eea;color:white;border:none;padding:15px 30px;border-radius:25px;font-size:1.1rem;cursor:pointer;transition:all .3s}
button:hover{background:#764ba2;transform:translateY(-2px);box-shadow:0 10px 20px rgba(0,0,0,0.2)}</textarea>
          </div>
        </div>

        <div class="editor-pane" id="jsPane">
          <div class="editor-with-numbers">
            <div class="line-numbers" id="jsLineNumbers">1</div>
            <textarea class="code-editor" id="jsEditor" placeholder="JavaScript 코드를 입력하세요...">function sayHello(){
  alert('안녕하세요! CodeHub에 오신 것을 환영합니다! 🎉');
  const button = document.querySelector('button');
  if(button) button.textContent = '다시 클릭해보세요! ✨';
  const colors = [
    'linear-gradient(135deg,#667eea 0%,#764ba2 100%)',
    'linear-gradient(135deg,#f093fb 0%,#f5576c 100%)',
    'linear-gradient(135deg,#4facfe 0%,#00f2fe 100%)',
    'linear-gradient(135deg,#43e97b 0%,#38f9d7 100%)'
  ];
  document.body.style.background = colors[Math.floor(Math.random()*colors.length)];
}
document.addEventListener('DOMContentLoaded',function(){console.log('CodeHub ready 🚀')});</textarea>
          </div>
        </div>
      </div>
    </div>

    <div class="preview-container">
      <div class="preview-header">
        <div class="preview-title">미리보기</div>
        <div class="preview-actions">
          <button class="preview-btn" onclick="refreshPreview()">🔄</button>
          <button class="preview-btn" onclick="openInNewTab()">🔗</button>
        </div>
      </div>
      <iframe class="preview-frame" id="previewFrame" sandbox="allow-same-origin allow-scripts"></iframe>
    </div>
  </div>

  <div class="status-bar">
    <div>준비됨 ✅</div>
    <div id="statusInfo">HTML | 라인 1</div>
  </div>

<script>
/* ----------------- 내부 상태 ----------------- */
let currentFile = 'html';
let files = {
  html: document.getElementById('htmlEditor').value,
  css: document.getElementById('cssEditor').value,
  js: document.getElementById('jsEditor').value
};

/* ----------------- 유틸: 라인 번호 갱신 ----------------- */
function updateLineNumbers(fileType){
  const editor = document.getElementById(`${fileType}Editor`);
  const lineNumbers = document.getElementById(`${fileType}LineNumbers`);
  const lines = Math.max(1, editor.value.split('\n').length);
  let numbers = '';
  for(let i=1;i<=lines;i++) numbers += i + '\n';
  lineNumbers.textContent = numbers;
}

/* ----------------- 탭/파일 전환 ----------------- */
document.querySelectorAll('.tab').forEach(tab=>{
  tab.addEventListener('click',()=>{
    const tabType = tab.dataset.tab;
    switchTab(tabType);
  });
});
function switchTab(tabType){
  saveCurrentFile();
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelector(`[data-tab="${tabType}"]`).classList.add('active');
  document.querySelectorAll('.editor-pane').forEach(p=>p.classList.remove('active'));
  document.getElementById(`${tabType}Pane`).classList.add('active');
  currentFile = tabType;
  loadFileContent(tabType);
  updateLineNumbers(tabType);
  updateStatus();
}

/* 파일 탐색기 클릭 처리 */
document.querySelectorAll('.file-item').forEach(item=>{
  item.addEventListener('click',()=>{
    const fileType = item.dataset.file;
    // 탭도 전환
    switchTab(fileType);
    document.querySelectorAll('.file-item').forEach(f=>f.classList.remove('active'));
    item.classList.add('active');
  });
});

/* ----------------- 편집기 이벤트 바인딩 ----------------- */
['html','css','js'].forEach(type=>{
  const editor = document.getElementById(`${type}Editor`);
  editor.addEventListener('input', ()=>{
    files[type] = editor.value;
    updateLineNumbers(type);
    // 디바운스 미리보기 갱신
    clearTimeout(window.previewTimeout);
    window.previewTimeout = setTimeout(updatePreview, 500);
  });
  editor.addEventListener('scroll', ()=> {
    document.getElementById(`${type}LineNumbers`).scrollTop = editor.scrollTop;
  });
});

/* ----------------- 파일 저장/로드 ----------------- */
function saveCurrentFile(){
  const editor = document.getElementById(`${currentFile}Editor`);
  files[currentFile] = editor.value;
}
function loadFileContent(fileType){
  document.getElementById(`${fileType}Editor`).value = files[fileType] || '';
}

/* ----------------- 미리보기 생성(안전하게) ----------------- */
function buildFullHTML(){
  let html = files.html || '';
  const css = files.css || '';
  const js = files.js || '';

  // CSS 삽입: 기존 link 교체 또는 head 끝에 삽입
  if(html.includes('<link rel="stylesheet" href="style.css">')){
    html = html.replace('<link rel="stylesheet" href="style.css">', `<style>${css}</style>`);
  } else if(html.includes('</head>')){
    html = html.replace('</head>', `<style>${css}</style></head>`);
  } else {
    // 헤드가 없으면 앞에 추가
    html = `<head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">${'<style>'+css+'</style>'}</head>` + html;
  }

  // JS 삽입: 기존 script tag 교체 또는 body 끝에 삽입
  if(html.includes('<script src="script.js"></script>')){
    html = html.replace('<script src="script.js"></script>', `<script>${js}</script>`);
  } else if(html.includes('</body>')){
    html = html.replace('</body>', `<script>${js}<\/script></body>`);
  } else {
    html += `<script>${js}<\/script>`;
  }

  return html;
}

function updatePreview(){
  saveCurrentFile();
  const fullHTML = buildFullHTML();
  const iframe = document.getElementById('previewFrame');
  // blob으로 주면 CSP/파일 경로 문제 덜 생김
  const blob = new Blob([fullHTML], {type: 'text/html'});
  const url = URL.createObjectURL(blob);
  iframe.src = url;
  // revoke (약간 시간 둠)
  setTimeout(()=>URL.revokeObjectURL(url), 1500);
}

/* 새로고침 / 새탭 열기 */
function refreshPreview(){ updatePreview(); }
function openInNewTab(){
  saveCurrentFile();
  const fullHTML = buildFullHTML();
  const blob = new Blob([fullHTML], {type: 'text/html'});
  const url = URL.createObjectURL(blob);
  window.open(url, '_blank');
  setTimeout(()=>URL.revokeObjectURL(url), 1500);
}

/* ----------------- 프로젝트 저장(로컬 다운로드) ----------------- */
function saveProject(){
  saveCurrentFile();
  const project = { html: files.html, css: files.css, js: files.js, timestamp: new Date().toISOString() };
  const blob = new Blob([JSON.stringify(project, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'codehub-project.json'; document.body.appendChild(a); a.click(); a.remove();
  URL.revokeObjectURL(url);
}

/* ----------------- 공유 (링크 생성, base64) ----------------- */
function shareProject(){
  saveCurrentFile();
  try{
    const encoded = btoa(unescape(encodeURIComponent(JSON.stringify(files))));
    const shareUrl = `${location.origin}${location.pathname}?project=${encoded}`;
    navigator.clipboard.writeText(shareUrl).then(()=>alert('프로젝트 링크가 클립보드에 복사되었습니다!'));
  }catch(e){
    alert('공유에 실패했습니다: ' + e.message);
  }
}

/* ----------------- 템플릿 로드 (기능 정의 누락 문제 해결) ----------------- */
function loadTemplate(templateType){
  const templates = {
    basic: {
      html: `<!DOCTYPE html>
<html lang="ko"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"><title>기본 웹페이지</title><link rel="stylesheet" href="style.css"></head><body><header><h1>내 웹사이트</h1></header><main><p>환영합니다!</p></main><script src="script.js"></script></body></html>`,
      css: `body{font-family:Arial,sans-serif;margin:0;padding:0}header{background:#2c3e50;color:white;padding:1rem;text-align:center}`,
      js: `document.addEventListener('DOMContentLoaded',function(){console.log('basic template loaded')});`
    },
    portfolio: {
      html: `<!DOCTYPE html><html lang="ko"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"><title>포트폴리오</title><link rel="stylesheet" href="style.css"></head><body><section class="hero"><h1>포트폴리오</h1></section><script src="script.js"></script></body></html>`,
      css: `body{font-family:Arial,sans-serif} .hero{height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}`,
      js: `function scrollToProjects(){document.getElementById('projects')?.scrollIntoView({behavior:'smooth'})}`
    },
    dashboard: {
      html: `<!DOCTYPE html><html lang="ko"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"><title>대시보드</title><link rel="stylesheet" href="style.css"></head><body><div class="dashboard"><h1>대시보드</h1></div><script src="script.js"></script></body></html>`,
      css: `body{font-family:Arial,sans-serif;background:#f5f5f5}.dashboard{padding:2rem}`,
      js: `console.log('dashboard template')`
    },
    game: {
      html: `<!DOCTYPE html><html lang="ko"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"><title>미니 게임</title><link rel="stylesheet" href="style.css"></head><body><canvas id="gameCanvas" width="800" height="400"></canvas><script src="script.js"></script></body></html>`,
      css: `body{margin:0;background:#111;color:#fff} canvas{display:block;margin:0 auto;background:#000;border:3px solid #333}`,
      js: `const c=document.getElementById('gameCanvas');if(c){const g=c.getContext('2d');g.fillStyle='#fff';g.fillRect(10,10,50,50)}`
    }
  };

  if(templates[templateType]){
    files = templates[templateType];
    document.getElementById('htmlEditor').value = files.html;
    document.getElementById('cssEditor').value = files.css;
    document.getElementById('jsEditor').value = files.js;
    updateLineNumbers('html'); updateLineNumbers('css'); updateLineNumbers('js');
    updatePreview();
  } else {
    alert('템플릿을 찾을 수 없습니다.');
  }
}

/* ----------------- 새 파일 추가(간단) ----------------- */
function addNewFile(){
  const name = prompt('새 파일명 (html/css/js 중 하나 입력):', 'html');
  if(!name) return;
  if(!['html','css','js'].includes(name)) { alert('지원되지 않는 파일 타입입니다. html, css, js 중 선택하세요.'); return; }
  // 탭 전환만 해줄게
  switchTab(name);
}

/* ----------------- 실행관련(버튼) ----------------- */
function runCode(){ updatePreview(); }

/* ----------------- URL에서 프로젝트 로드 ----------------- */
(function(){
  const urlParams = new URLSearchParams(window.location.search);
  const projectData = urlParams.get('project');
  if(projectData){
    try {
      const p = JSON.parse(decodeURIComponent(escape(atob(projectData))));
      if(p.html) files.html = p.html;
      if(p.css) files.css = p.css;
      if(p.js) files.js = p.js;
      document.getElementById('htmlEditor').value = files.html;
      document.getElementById('cssEditor').value = files.css;
      document.getElementById('jsEditor').value = files.js;
      updateLineNumbers('html'); updateLineNumbers('css'); updateLineNumbers('js');
      updatePreview();
    } catch(e){ console.error('프로젝트 로드 실패', e) }
  } else {
    // 초기 미리보기 로드
    updatePreview();
  }
})();

/* ----------------- 상태바 업데이트 ----------------- */
function updateStatus(){
  const lines = document.getElementById(`${currentFile}Editor`).value.split('\n').length;
  document.getElementById('statusInfo').textContent = `${currentFile.toUpperCase()} | 라인 ${lines}`;
}

/* 초기 라인번호 세팅 */
updateLineNumbers('html'); updateLineNumbers('css'); updateLineNumbers('js');
</script>
</body>
</html>
